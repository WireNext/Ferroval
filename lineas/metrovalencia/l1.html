<!DOCTYPE html>
<html lang="ca-VA">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L铆nia 1 - Ferroval Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .line-l1 { background-color: #f3bc2e; }
        .station-dot { width: 12px; height: 12px; border-radius: 50%; background: white; border: 3px solid #f3bc2e; position: relative; z-index: 10; }
        .line-vertical { position: absolute; left: 4.5px; top: 0; bottom: 0; width: 3px; background-color: #f3bc2e; z-index: 0; }
        .station-item:first-child .line-vertical { top: 50%; }
        .station-item:last-child .line-vertical { height: 50%; }
        .live-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-[#F3F4F6] text-slate-800 font-sans">

    <header class="bg-white border-b border-gray-200 p-6 mb-6">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="line-l1 text-white w-10 h-10 rounded-xl flex items-center justify-center text-xl font-black italic shadow-md">1</div>
                <div>
                    <h1 class="text-xl font-black text-slate-900 uppercase italic leading-none">Ferroval</h1>
                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest italic">Connexi贸 Directa Metrovalencia</p>
                </div>
            </div>
            <div id="status-badge" class="bg-slate-100 text-slate-500 px-3 py-1.5 rounded-full text-[9px] font-black border border-slate-200 italic uppercase">
                En l铆nia
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 max-w-5xl">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <section class="bg-white p-6 rounded-[32px] shadow-sm border border-gray-100 h-fit">
                <h2 class="text-[10px] font-black mb-8 text-slate-400 uppercase tracking-widest italic"> Parades Clau L1</h2>
                <div class="relative ml-2 space-y-8">
                    <div class="station-item relative flex items-center pl-8">
                        <div class="line-vertical"></div><div class="station-dot absolute left-0"></div>
                        <p class="font-bold text-slate-600 uppercase italic text-sm">B茅tera</p>
                    </div>
                    <div class="station-item relative flex items-center pl-8">
                        <div class="line-vertical"></div><div class="station-dot absolute left-0"></div>
                        <p class="font-black text-slate-900 uppercase italic text-lg border-b-2 border-yellow-400 inline-block">. Guimer</p>
                    </div>
                    <div class="station-item relative flex items-center pl-8">
                        <div class="line-vertical"></div><div class="station-dot absolute left-0"></div>
                        <p class="font-bold text-slate-600 uppercase italic text-sm">Castell贸</p>
                    </div>
                </div>
            </section>

            <section class="lg:col-span-2">
                <div class="bg-white p-6 rounded-[32px] shadow-sm border border-gray-100 min-h-[400px]">
                    <div class="mb-8">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2 mb-2 block italic">Tria estaci贸 per a consultar</label>
                        <select id="station-selector" class="w-full bg-slate-50 border border-slate-100 text-slate-800 p-4 rounded-2xl font-bold text-md outline-none focus:ring-2 focus:ring-yellow-400 italic cursor-pointer">
                            <option value="">-- Selecciona --</option>
                            <option value="17">ngel Guimer</option>
                            <option value="107">B茅tera</option>
                            <option value="35">Castell贸</option>
                            <option value="30">Val猫ncia Sud</option>
                            <option value="55">Empalme</option>
                            <option value="16">Xtiva</option>
                            <option value="15">Col贸n</option>
                        </select>
                    </div>

                    <div id="timetable-display" class="space-y-3">
                        <div class="text-center py-20 opacity-20 italic">
                            <p class="text-xs font-black uppercase tracking-widest">Dades en temps real</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        document.getElementById('station-selector').addEventListener('change', async function() {
            const display = document.getElementById('timetable-display');
            const status = document.getElementById('status-badge');
            const stationId = this.value;

            if (!stationId) return;

            // Indicador de crrega
            display.innerHTML = '<div class="flex justify-center py-20"><div class="w-6 h-6 border-2 border-yellow-400 border-t-transparent rounded-full animate-spin"></div></div>';
            status.innerText = "ACTUALITZANT...";
            status.className = "bg-yellow-50 text-yellow-600 px-3 py-1.5 rounded-full text-[9px] font-black border border-yellow-100 live-pulse italic uppercase";

            try {
                // Utilitzem el proxy per a poder llegir la URL de Metrovalencia sense bloquejos
                const urlOficial = `https://www.metrovalencia.es/wp-content/themes/metrovalencia/functions/ajax-no-wp.php?action=get_proximos_pasos&estacion=${stationId}`;
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(urlOficial)}`;

                const response = await fetch(proxyUrl);
                const result = await response.json();
                
                // Extraiem l'HTML que ve dins del JSON
                const data = JSON.parse(result.contents);
                const htmlBrut = data.html;

                // Processar l'HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlBrut, 'text/html');
                const blocsTrens = doc.querySelectorAll('.item--proximos');

                if (blocsTrens.length === 0) {
                    display.innerHTML = '<p class="text-center py-20 font-bold text-slate-300 italic uppercase text-[10px]">No hi ha previsions disponibles ara</p>';
                    status.innerText = "SENSE DADES";
                    return;
                }

                status.innerText = "DIRECTE";
                status.className = "bg-emerald-50 text-emerald-600 px-3 py-1.5 rounded-full text-[9px] font-black border border-emerald-100 italic uppercase";

                display.innerHTML = "";
                blocsTrens.forEach(bloc => {
                    const desti = bloc.querySelector('.nombre-estacion')?.innerText.trim() || "Desconegut";
                    const minuts = bloc.querySelector('.minutos')?.innerText.trim() || "--";
                    const imgUrl = bloc.querySelector('img')?.src || "";

                    display.innerHTML += `
                        <div class="flex items-center justify-between p-5 rounded-2xl border border-slate-50 bg-slate-50/50 hover:bg-white transition-all shadow-sm">
                            <div class="flex items-center gap-4">
                                <img src="${imgUrl}" class="w-7 h-7" alt="L铆nia">
                                <div>
                                    <p class="font-black text-slate-800 text-sm uppercase italic tracking-tight">${desti}</p>
                                    <p class="text-[8px] font-bold text-slate-400 uppercase italic">Pr貌xim tren</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-black text-slate-900 italic">${minuts.replace(' min', '')}<span class="text-[10px] ml-1 uppercase">min</span></p>
                            </div>
                        </div>
                    `;
                });

            } catch (e) {
                console.error(e);
                display.innerHTML = `<p class="p-10 text-center text-red-400 font-bold italic text-[10px]">Error al connectar amb Metrovalencia</p>`;
                status.innerText = "ERROR";
            }
        });
    </script>
</body>
</html>